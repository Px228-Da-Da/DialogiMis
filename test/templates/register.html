{% extends 'base.html' %}
{% block content %}
<div class="limiter">
    <div class="container-login100">
        <div class="wrap-login100 p-t-50 p-b-90">
            <span class="login100-form-title p-b-51">
                Register
            </span>
            <div id="message"  class="login100-form-title p-b-51">Confirm your email address</div>
            <form id="registerForm" action="/add_user" method="post" class="login100-form validate-form flex-sb flex-w" method="POST" action="/register">
                <form id="frrfr">
                    <div class="wrap-input100 validate-input m-b-16" data-validate="Email is required">
                        <input class="input100" type="email" name="email" id="email" placeholder="Email" required>
                        <span class="focus-input100"></span>
                    </div>
                    <!-- Добавьте поле ввода для имени пользователя -->
                    <div class="wrap-input100 validate-input m-b-16" data-validate="Username is required">
                        <input class="input100" type="text" name="username" id="username" placeholder="Username" required>
                        <span class="focus-input100"></span>
                    </div>
                    
                    <div class="wrap-input100 validate-input m-b-16" data-validate="Password is required">
                        <input class="input100" type="password" name="password" id="password" placeholder="Password" required>
                        <span class="focus-input100"></span>
                    </div>
                    <div class="flex-sb-m w-full p-t-3 p-b-24">
                        <div>
                            <a href="{{url_for('login')}}" class="txt1">
                                Log In
                            </a>
                        </div>
                    </div>
                    <div class="container-login100-form-btn m-t-17">
                        <button class="login100-form-btn" type="submit">
                            Register
                        </button>
                        
                    </div>
                </form>
            </form>
        </div>
    </div>
</div>



<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
<script>
    var socket = io.connect('http://' + document.domain + ':' + location.port);
    
    var message = document.getElementById('message');
    var registerForm = document.getElementById('registerForm');

    // Получаем доступ к элементу формы по его id
    var formElement = document.getElementById("registerForm");

    message.style.display = "none";
    
    registerForm.addEventListener('submit', function(event) {
        event.preventDefault(); // Предотвращаем отправку формы по умолчанию

        var email = document.getElementById('email').value;
        var password = document.getElementById('password').value;
        var username = document.getElementById('username').value;
        
        socket.emit('signup', { email: email, password: password, username: username });
    });

    socket.on('email_verified', function() {
        message.innerHTML = 'Email confirmed successfully..';
    });

    socket.on('email_not_verified', function() {
        formElement.style.display = "none";
        message.style.display = "block";
        message.innerHTML = 'Confirm your email address';
    });

    socket.on('email_verification_error', function(error) {
        message.innerHTML = 'Ошибка подтверждения email: ' + error;
    });
</script>



{% endblock %}
